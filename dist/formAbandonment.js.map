{"version":3,"sources":["../src/formAbandonment.js"],"names":["tna_gtag_manager","config","$inputs","$","selector","$parentForm","parents","first","_array","_arrayError","_formID","attr","assign_handlers_on_blur","on","$this","val","push","get_error_name","errorSelector","each","$getAttrID","inArray","checkSubmit","dataLayer","Array","isArray","i","length","event_action","formID","fieldName","arrayError","errors","join","fields","assign_before_unload_actions","window","undefined","init"],"mappings":"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","file":"formAbandonment.js","sourcesContent":["/**\n * ------------  THE NATIONAL ARCHIVES  -----------------\n * JS Form Abandonment for Google Tag Manager\n * Magic stuff\n * */\nvar tna_gtag_manager = (function (config) {\n    /** Declare block scope variables */\n    let $inputs = $(config.selector),\n        $parentForm = $inputs.parents('form').first(),\n        _array = [],\n        _arrayError = [],\n        _formID = 'ID: ' + $parentForm.attr('id') + ' > ';\n\n    /**\n     * Assign event handlers on blur\n     * Check if the input is empty and if it is do not add it to the _array\n     * If data is entered in the field add the field ID into the _array\n     * */\n    let assign_handlers_on_blur = function () {\n        $inputs.on('blur', function () {\n            let $this = $(this);\n            if ($this.val() === '') {\n                return;\n            }\n            _array.push($this.attr('id'));\n            get_error_name();\n        });\n    };\n\n    /**\n     * If error element is visible check if does exist in the _arrayError\n     * If it doesn't, add it's ID to the the array\n     * */\n    let get_error_name = function () {\n        $(config.errorSelector).each(function () {\n            /** Declare block scope variables */\n            let $this = $(this),\n                $getAttrID = $this.attr('id');\n            /** Check if value exists in _arrayError and if it does do nothing */\n            if ($.inArray($getAttrID, _arrayError) !== -1) {\n                return;\n            }\n            /** Add error ID to the _arrayError */\n            _arrayError.push($getAttrID);\n        });\n    };\n    /**\n     * Check if contact form was submitted\n     * */\n    let checkSubmit = function (dataLayer) {\n        if (Array.isArray(dataLayer)) {\n            let i = dataLayer.length - 1;\n            while (i > -1) {\n                if (dataLayer[i]['event'] === 'gtm.formSubmit') {\n                    return true;\n                }\n                i--;\n            }\n        }\n    };\n\n    /**\n     * Event action output\n     * */\n    let event_action = function (formID, fieldName, arrayError) {\n        let errors = (arrayError && arrayError.length !== 0) ? \" > Error: \" + arrayError.join(' > ') : \"\";\n        let fields = (fieldName && fieldName.length !== 0) ? \"Field: \" + fieldName.join(' > ') : \"\";\n        return formID + fields + errors;\n    };\n    /**\n     * Google tag manager dataLayer\n     * If the\n     * */\n    let assign_before_unload_actions = function () {\n        $(window).on('beforeunload', function () {\n            // Make sure the form was not submited before pushing data into datalyer\n            if (!checkSubmit(dataLayer) &&  _formID !== undefined && _array.length !== 0) {\n                dataLayer.push({\n                    'event': 'formAbandonment',\n                    'eventCategory': 'Form Abandonment',\n                    'eventAction': event_action(_formID, _array, _arrayError)\n                });\n            }\n        });\n    };\n\n    /**\n     * Init\n     * */\n    let init = function () {\n        assign_before_unload_actions();\n        assign_handlers_on_blur();\n    };\n    init();\n    /**\n     * Return the magic stuff (object)\n     * */\n    return {\n        _array: _array,\n        _arrayError: _arrayError,\n        _formID: _formID,\n        config:config,\n        init:init,\n        event_action:event_action,\n        get_error_name:get_error_name\n    };\n})({selector: '.form-abandonment :input', errorSelector: '.form-error'});"]}